<!DOCTYPE html>
<html>
<head>
    <title>Text Processing Tools</title>
    <style>
        /* [Previous CSS remains the same] */
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="openTab(event, 'latexCleaner')">LaTeX Format Cleaner</button>
            <button class="tab" onclick="openTab(event, 'caseCleaner')">Case Converter</button>
            <button class="tab" onclick="openTab(event, 'textCounter')">Text Counter</button>
        </div>

        <!-- LaTeX Format Cleaner -->
        <div id="latexCleaner" class="tab-content active">
            <div class="description">
                Remove LaTeX formatting commands while handling nested structures:
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>\textcolor{}: Preserves text inside, ignores nested braces</li>
                    <li>\sout{}: Removes entire block, including nested content</li>
                </ul>
            </div>
            <label for="latexInput">Input LaTeX Text:</label>
            <textarea id="latexInput" placeholder="Paste your LaTeX text here..."></textarea>
            <div style="margin: 10px 0;">
                <button onclick="cleanLaTeX()">Remove Formatting</button>
                <button onclick="showExample()" style="background-color: #666;">Show Example</button>
            </div>
            <label for="latexOutput">Cleaned Output:</label>
            <textarea id="latexOutput" readonly placeholder="Cleaned text will appear here..."></textarea>
        </div>

        <!-- [Other tabs remain the same] -->
    </div>

    <script>
        function findClosingBrace(text, startIndex) {
            let braceCount = 1;
            let i = startIndex;
            
            while (i < text.length && braceCount > 0) {
                if (text[i] === '{') braceCount++;
                if (text[i] === '}') braceCount--;
                i++;
            }
            
            return i - 1; // Return the position of the matching closing brace
        }

        function cleanLaTeX() {
            let input = document.getElementById('latexInput').value;
            let result = '';
            let i = 0;

            while (i < input.length) {
                if (input.slice(i).startsWith('\\textcolor{')) {
                    // Skip '\textcolor{'
                    i += 10;
                    // Find the end of the color specification
                    let colorEnd = findClosingBrace(input, i);
                    if (colorEnd === -1) {
                        result += input[i];
                        i++;
                        continue;
                    }
                    // Skip to content part
                    i = colorEnd + 2; // +2 to skip '}{' after color
                    // Find the end of the content
                    let contentEnd = findClosingBrace(input, i);
                    if (contentEnd === -1) {
                        result += input[i];
                        i++;
                        continue;
                    }
                    // Add the content
                    result += input.slice(i, contentEnd);
                    i = contentEnd + 1;
                }
                else if (input.slice(i).startsWith('\\sout{')) {
                    // Skip '\sout{' and all content until matching '}'
                    i += 6;
                    let soutEnd = findClosingBrace(input, i);
                    if (soutEnd === -1) {
                        result += input[i];
                        i++;
                        continue;
                    }
                    i = soutEnd + 1;
                }
                else {
                    result += input[i];
                    i++;
                }
            }

            // Clean up extra whitespace
            result = result.replace(/\s+/g, ' ').trim();
            document.getElementById('latexOutput').value = result;
        }

        function showExample() {
            const example = `Here is some text with \\textcolor{red}{colored text with {nested} braces} and \\sout{struck out text with {nested} content}.
            
Another example: \\textcolor{blue}{Text with multiple {nested} {braces} inside} and normal text.

\\sout{Remove this entirely {even} {with} {nested} {braces}} but keep this.`;
            document.getElementById('latexInput').value = example;
        }

        // [Other functions remain the same]
    </script>
</body>
</html>